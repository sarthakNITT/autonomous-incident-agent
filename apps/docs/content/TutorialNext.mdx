# Tutorial: Next.js Integration

This guide covers setting up AIA with a Next.js App Router project using Bun.

## Step 1: Install Dependencies

<Tabs defaultValue="bun">
  <TabsList>
    <div className="flex items-center rounded-[4px] bg-[#18181b] p-0.5 border border-zinc-800/50">
      <TabsTrigger value="npm">npm</TabsTrigger>
      <TabsTrigger value="pnpm">pnpm</TabsTrigger>
      <TabsTrigger value="yarn">yarn</TabsTrigger>
      <TabsTrigger value="bun">bun</TabsTrigger>
    </div>
    <TabsCopyButton />
  </TabsList>
  <TabsContent value="npm">
    ```bash
    npm install @opentelemetry/api @opentelemetry/sdk-node \
      @opentelemetry/auto-instrumentations-node \
      @opentelemetry/exporter-trace-otlp-http
    ```
  </TabsContent>
  <TabsContent value="pnpm">
    ```bash
    pnpm add @opentelemetry/api @opentelemetry/sdk-node \
      @opentelemetry/auto-instrumentations-node \
      @opentelemetry/exporter-trace-otlp-http
    ```
  </TabsContent>
  <TabsContent value="yarn">
    ```bash
    yarn add @opentelemetry/api @opentelemetry/sdk-node \
      @opentelemetry/auto-instrumentations-node \
      @opentelemetry/exporter-trace-otlp-http
    ```
  </TabsContent>
  <TabsContent value="bun">
    ```bash
    bun add @opentelemetry/api @opentelemetry/sdk-node \
      @opentelemetry/auto-instrumentations-node \
      @opentelemetry/exporter-trace-otlp-http
    ```
  </TabsContent>
</Tabs>

## Step 2: Enable Instrumentation

Update `next.config.js` to enable the experimental hook:

<Tabs defaultValue="terminal">
  <TabsList>
    <div className="flex items-center rounded-[4px] bg-[#18181b] p-0.5 border border-zinc-800/50">
      <TabsTrigger value="terminal">Terminal</TabsTrigger>
    </div>
    <TabsCopyButton />
  </TabsList>
  <TabsContent value="terminal">
    ```javascript
    const nextConfig = {
      experimental: {
        instrumentationHook: true,
      },
    };
    module.exports = nextConfig;
    ```
  </TabsContent>
</Tabs>

## Step 3: Create Instrumentation File

Create `instrumentation.ts` in your project root (or `src/`):

<Tabs defaultValue="terminal">
  <TabsList>
    <div className="flex items-center rounded-[4px] bg-[#18181b] p-0.5 border border-zinc-800/50">
      <TabsTrigger value="terminal">Terminal</TabsTrigger>
    </div>
    <TabsCopyButton />
  </TabsList>
  <TabsContent value="terminal">
    ```typescript
    export async function register() {
      if (process.env.NEXT_RUNTIME === 'nodejs') {
        await import('./instrumentation.node');
      }
    }
    ```
  </TabsContent>
</Tabs>

Create `app/page.tsx`:

<Tabs defaultValue="terminal">
  <TabsList>
    <div className="flex items-center rounded-[4px] bg-[#18181b] p-0.5 border border-zinc-800/50">
      <TabsTrigger value="terminal">Terminal</TabsTrigger>
    </div>
    <TabsCopyButton />
  </TabsList>
  <TabsContent value="terminal">
    ```tsx
    export default function Page() {
      return (
        <button onClick={() => { throw new Error("Button clicked"); }}>
          Click me
        </button>
      );
    }
    ```
  </TabsContent>
</Tabs>

## Step 4: Node SDK Setup

Create `instrumentation.node.ts`:

<Tabs defaultValue="terminal">
  <TabsList>
    <div className="flex items-center rounded-[4px] bg-[#18181b] p-0.5 border border-zinc-800/50">
      <TabsTrigger value="terminal">Terminal</TabsTrigger>
    </div>
    <TabsCopyButton />
  </TabsList>
  <TabsContent value="terminal">
    ```typescript
    import { NodeSDK } from '@opentelemetry/sdk-node';
    import { OTLPTraceExporter } from '@opentelemetry/exporter-trace-otlp-http';
    import { getNodeAutoInstrumentations } from '@opentelemetry/auto-instrumentations-node';

    const sdk = new NodeSDK({
      traceExporter: new OTLPTraceExporter({
        url: process.env.OTEL_EXPORTER_OTLP_ENDPOINT || 'http://localhost:3001/v1/traces',
      }),
      instrumentations: [getNodeAutoInstrumentations()],
    });

    sdk.start();
    ```
  </TabsContent>
</Tabs>

## Step 5: Verify

Start your app:

<Tabs defaultValue="bun">
  <TabsList>
    <div className="flex items-center rounded-[4px] bg-[#18181b] p-0.5 border border-zinc-800/50">
      <TabsTrigger value="npm">npm</TabsTrigger>
      <TabsTrigger value="pnpm">pnpm</TabsTrigger>
      <TabsTrigger value="yarn">yarn</TabsTrigger>
      <TabsTrigger value="bun">bun</TabsTrigger>
    </div>
    <TabsCopyButton />
  </TabsList>
  <TabsContent value="npm">
    ```bash
    npm run dev
    ```
  </TabsContent>
  <TabsContent value="pnpm">
    ```bash
    pnpm dev
    ```
  </TabsContent>
  <TabsContent value="yarn">
    ```bash
    yarn dev
    ```
  </TabsContent>
  <TabsContent value="bun">
    ```bash
    bun run dev
    ```
  </TabsContent>
</Tabs>

Trigger an error in a Server Component and check the AIA logs.
