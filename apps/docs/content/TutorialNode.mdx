# Tutorial: Node.js Integration

This guide demonstrates how to integrate AIA into a standard Node.js/Express application.

## Prerequisites

-   Existing Node.js project.
-   Running AIA Agent.

## Step 1: Install Dependencies

<Tabs defaultValue="bun">
  <TabsList>
    <div className="flex items-center rounded-[4px] bg-[#18181b] p-0.5 border border-zinc-800/50">
      <TabsTrigger value="npm">npm</TabsTrigger>
      <TabsTrigger value="pnpm">pnpm</TabsTrigger>
      <TabsTrigger value="yarn">yarn</TabsTrigger>
      <TabsTrigger value="bun">bun</TabsTrigger>
    </div>
    <TabsCopyButton />
  </TabsList>
  <TabsContent value="npm">
    ```bash
    npm install @opentelemetry/api @opentelemetry/sdk-node \
      @opentelemetry/auto-instrumentations-node \
      @opentelemetry/exporter-trace-otlp-http
    ```
  </TabsContent>
  <TabsContent value="pnpm">
    ```bash
    pnpm add @opentelemetry/api @opentelemetry/sdk-node \
      @opentelemetry/auto-instrumentations-node \
      @opentelemetry/exporter-trace-otlp-http
    ```
  </TabsContent>
  <TabsContent value="yarn">
    ```bash
    yarn add @opentelemetry/api @opentelemetry/sdk-node \
      @opentelemetry/auto-instrumentations-node \
      @opentelemetry/exporter-trace-otlp-http
    ```
  </TabsContent>
  <TabsContent value="bun">
    ```bash
    bun add @opentelemetry/api @opentelemetry/sdk-node \
      @opentelemetry/auto-instrumentations-node \
      @opentelemetry/exporter-trace-otlp-http
    ```
  </TabsContent>
</Tabs>

## Step 2: Configure Instrumentation

Create `instrumentation.ts`:

<Tabs defaultValue="terminal">
  <TabsList>
    <div className="flex items-center rounded-[4px] bg-[#18181b] p-0.5 border border-zinc-800/50">
      <TabsTrigger value="terminal">Terminal</TabsTrigger>
    </div>
    <TabsCopyButton />
  </TabsList>
  <TabsContent value="terminal">
    ```typescript
    import { NodeSDK } from '@opentelemetry/sdk-node';
    import { OTLPTraceExporter } from '@opentelemetry/exporter-trace-otlp-http';
    import { getNodeAutoInstrumentations } from '@opentelemetry/auto-instrumentations-node';

    const sdk = new NodeSDK({
      traceExporter: new OTLPTraceExporter({
        url: 'http://localhost:3001/v1/traces',
      }),
      instrumentations: [getNodeAutoInstrumentations()],
    });

    sdk.start();
    ```
  </TabsContent>
</Tabs>

## Step 3: Connect to App

Import it at the **top** of your entry file:

<Tabs defaultValue="terminal">
  <TabsList>
    <div className="flex items-center rounded-[4px] bg-[#18181b] p-0.5 border border-zinc-800/50">
      <TabsTrigger value="terminal">Terminal</TabsTrigger>
    </div>
    <TabsCopyButton />
  </TabsList>
  <TabsContent value="terminal">
    ```typescript
    import './instrumentation';
    import express from 'express';
    // ... imports

    const app = express();

    app.get('/error', (req, res) => {
      // Intentional error
      const user = undefined;
      console.log(user.name);
      res.send('ok');
    });

    app.listen(3000, () => {
      console.log('Server running on port 3000');
    });
    ```
  </TabsContent>
</Tabs>

## Step 4: Test

Run and visit `/error`.

<Tabs defaultValue="bun">
  <TabsList>
    <div className="flex items-center rounded-[4px] bg-[#18181b] p-0.5 border border-zinc-800/50">
      <TabsTrigger value="bun">bun</TabsTrigger>
    </div>
    <TabsCopyButton />
  </TabsList>
  <TabsContent value="bun">
    ```bash
    bun run server.ts
    ```
  </TabsContent>
</Tabs>
